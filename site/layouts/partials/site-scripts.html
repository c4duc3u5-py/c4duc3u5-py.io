{{/* site-scripts.html â€” Vanilla JS enhancements */}}
<script>
(function() {
  'use strict';

  /* ===== Reading Progress Bar ===== */
  function initProgressBar() {
    var bar = document.createElement('div');
    bar.className = 'reading-progress';
    bar.setAttribute('aria-hidden', 'true');
    document.body.prepend(bar);

    var ticking = false;
    window.addEventListener('scroll', function() {
      if (!ticking) {
        requestAnimationFrame(function() {
          var scrollTop = window.scrollY || document.documentElement.scrollTop;
          var docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
          bar.style.width = docHeight > 0 ? (scrollTop / docHeight * 100) + '%' : '0%';
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });
  }

  /* ===== Mobile Nav Toggle ===== */
  function initMobileNav() {
    var toggle = document.querySelector('.nav-toggle');
    var links = document.querySelector('.nav-links');
    if (!toggle || !links) return;
    toggle.addEventListener('click', function() {
      var isOpen = links.classList.toggle('open');
      toggle.setAttribute('aria-expanded', isOpen);
    });
    // Close menu when clicking a link
    links.querySelectorAll('.nav-link').forEach(function(link) {
      link.addEventListener('click', function() {
        links.classList.remove('open');
        toggle.setAttribute('aria-expanded', 'false');
      });
    });
  }

  /* ===== Sticky Nav Shadow on Scroll ===== */
  function initNavScroll() {
    var nav = document.querySelector('.site-nav');
    if (!nav) return;
    var scrolled = false;
    window.addEventListener('scroll', function() {
      var shouldShow = window.scrollY > 10;
      if (shouldShow !== scrolled) {
        scrolled = shouldShow;
        nav.style.boxShadow = scrolled ? '0 1px 3px rgba(0,0,0,0.08)' : 'none';
      }
    }, { passive: true });
  }

  /* ===== Lazy Loading for Images ===== */
  function initLazyImages() {
    if ('loading' in HTMLImageElement.prototype) {
      document.querySelectorAll('img:not([loading])').forEach(function(img) {
        img.setAttribute('loading', 'lazy');
      });
    }
  }

  /* ===== External eBay Link Handler ===== */
  function initExternalLinks() {
    document.querySelectorAll('a[href*="ebay.com"]').forEach(function(link) {
      link.setAttribute('target', '_blank');
      link.setAttribute('rel', 'noopener noreferrer');
    });
  }

  /* ===== Smooth Scroll for Anchor Links ===== */
  function initSmoothScroll() {
    document.addEventListener('click', function(e) {
      var link = e.target.closest('a[href^="#"]');
      if (!link) return;
      var id = link.getAttribute('href').slice(1);
      if (!id) return;
      var target = document.getElementById(id);
      if (target) {
        e.preventDefault();
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        history.pushState(null, '', '#' + id);
      }
    });
  }

  /* ===== Init ===== */
  function init() {
    initProgressBar();
    initMobileNav();
    initNavScroll();
    initLazyImages();
    initExternalLinks();
    initSmoothScroll();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
